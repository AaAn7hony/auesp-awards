<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AWARDS 2025 - AUEsp</title>
    <link rel="stylesheet" href="css/index.css">
</head>
<body>
    <section id="uno">
        <img src="img/logo.png" alt="Logo Awards 2025">
        <p>¡El AWARDS 2025 ya está aquí! Nomina a tus favoritos.</p>
    </section>

    <section id="dos">
        <button id="loginBtn">¡NOMINA AHORA!</button>
    </section>

    <footer>
        <div class="slide">
            <span>• Artista del año • Dibujo del año • Mejor jugador • Mejor clip • Gifter del año • Staff favorito • "Entretenimiento" favorito • Mejor evento • Juego favorito • MVP • Usuario favorito</span>
            <span>• Artista del año • Dibujo del año • Mejor jugador • Mejor clip • Gifter del año • Staff favorito • "Entretenimiento" favorito • Mejor evento • Juego favorito • MVP • Usuario favorito</span>
        </div>   
    </footer>

    <div id="glow"></div>

<script>
const glow = document.getElementById('glow');
const size = 50;

document.addEventListener('mousemove', (event) => {
    const x = event.clientX;
    const y = event.clientY;

    glow.style.background = `
      radial-gradient(
        circle ${size}px at ${x}px ${y}px,
        rgba(255, 255, 0, 0.1),
        rgba(0, 0, 0, 0)
      )
    `;
});
</script>

<script>
    const CLIENT_ID = '1205103896796725278';
    const REDIRECT_URI = 'https://aaan7hony.github.io/auesp-awards/nominaciones.html';
    const SCOPE = 'identify';

    const loginBtn = document.getElementById('loginBtn');

    const urlParams = new URLSearchParams(window.location.search);
    const code = urlParams.get('code');

    if (code) {
        fetch("https://discord.com/api/oauth2/token", {
            method: "POST",
            headers: { "Content-Type": "application/x-www-form-urlencoded" },
            body: new URLSearchParams({
                client_id: CLIENT_ID,
                client_secret: "-wZjSAFytLiT-7yhxtrV6Nq6hHFegami",
                grant_type: "authorization_code",
                code: code,
                redirect_uri: REDIRECT_URI
            })
        })
        .then(res => res.json())
        .then(data => {
            if (!data.access_token) throw new Error("Error token");

            return fetch("https://discord.com/api/users/@me", {
                headers: { Authorization: `Bearer ${data.access_token}` }
            });
        })
        .then(res => res.json())
        .then(user => {
            // Guardar para que el segundo código lo lea
            localStorage.setItem("discord_user_id", user.id);
            localStorage.setItem("discord_user_name", user.username);

            // Verificar si ya envió
            if (localStorage.getItem(`submitted_${user.id}`)) {
                alert("Ya has enviado tus nominaciones.");
                return;
            }

            // Ir al formulario
            window.location.href = "nominaciones.html";
        })
        .catch(err => {
            console.error(err);
            alert("Error en login. Intenta otra vez.");
        });
    }

    loginBtn.addEventListener("click", () => {
        window.location.href = 
        `https://discord.com/api/oauth2/authorize?client_id=${CLIENT_ID}&redirect_uri=${encodeURIComponent(REDIRECT_URI)}&response_type=code&scope=${SCOPE}`;
    });
</script>

</body>
</html>



